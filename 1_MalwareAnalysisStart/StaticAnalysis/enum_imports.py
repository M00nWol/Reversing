import pefile
import sys

mal_file = sys.argv[1]
pe = pefile.PE(mal_file)

output_file = "results/import_functions.txt"

with open(output_file, "w") as file:
    if hasattr(pe, 'DIRECTORY_ENTRY_IMPORT'):
        for entry in pe.DIRECTORY_ENTRY_IMPORT:
            line = f"{entry.dll.decode('utf-8')}\n"
            print(line.strip())
            file.write(line)

            for imp in entry.imports:
                if imp.name != None:
                    line = f"\t{imp.name.decode('utf-8')}\n"
                else:
                    line = f"\tord({str(imp.ordinal)})\n"
                print(line, end="")
                file.write(line)
            
            file.write("\n")
            print()